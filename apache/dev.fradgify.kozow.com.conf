<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    ServerName dev.fradgify.kozow.com
    ServerAlias www.dev.fradgify.kozow.com
    DocumentRoot /var/www/dev.fradgify.kozow.com

    # Enable Rewrite Engine
    RewriteEngine On

    # WSGI Configuration for Flask API
    WSGIDaemonProcess dev.fradgify.kozow.com python-home=/srv/fradgify/venv python-path=/var/www/dev.fradgify.kozow.com/flask_app
    WSGIProcessGroup dev.fradgify.kozow.com
    WSGIScriptAlias / /var/www/dev.fradgify.kozow.com/flask_app/flask_app.wsgi

    # Security Headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self';"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    ScriptLog ${APACHE_LOG_DIR}/cgi_log.log

    # Media directory alias
    Alias /media/ /var/www/dev.fradgify.kozow.com/media/

    # favicon.ico alias
    Alias /favicon.ico /var/www/dev.fradgify.kozow.com/static/icons/favicon.ico

    # http2 protocol for partial file requests
    Protocols h2 http/1.1

    <Directory "/var/www/dev.fradgify.kozow.com/media/sheets">
        Options +Indexes
        AllowOverride None
        Require all granted
        EnableSendfile Off
        HeaderName /static/html/navbar.html
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/music">
        Options +Indexes
        IndexOptions +Charset=UTF-8 +FancyIndexing
        IndexHeadInsert "<link rel='icon' href='/favicon.ico' type='image/x-icon'>"
        ReadmeName /spotify-footer.html
        AddType video/webm .webm .mov .m4v .mkv .mp4
        HeaderName /static/html/navbar.html
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/movies">
        Options +Indexes
        IndexOptions +FancyIndexing
        ReadmeName /custom-footer.html
        AllowOverride None
        AddType video/webm .webm .mov .m4v .mkv
        HeaderName /static/html/navbar.html
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/tv">
        Options +Indexes
        IndexOptions +FancyIndexing
        ReadmeName /disney-footer.html
        AllowOverride None
        AddType video/webm .webm .mov .m4v .mkv
        HeaderName /static/html/navbar.html
    </Directory>

    <Directory "/usr/lib/cgi-bin/">
        AllowOverride None
        Options +ExecCGI
        Require all granted
        AddHandler cgi-script .py
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/static">
        Require all granted
        AddType application/javascript .js
    </Directory>
</VirtualHost>
