<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    ServerName dev.fradgify.kozow.com
    ServerAlias www.dev.fradgify.kozow.com

    DocumentRoot /var/www/dev.fradgify.kozow.com

    # Enable Rewrite Engine
    RewriteEngine On

    # Custom Rewrites
    RewriteRule ^/whereisluke/?$ /usr/lib/cgi-bin/where_is_luke.py [L]
    # RewriteRule ^/$ /usr/lib/cgi-bin/fradgify_home.py [L]

    # WSGI Configuration for Flask API
    WSGIDaemonProcess dev.fradgify.kozow.com python-home=/srv/fradgify/venv python-path=/var/www/dev.fradgify.kozow.com/flask_app
    WSGIProcessGroup dev.fradgify.kozow.com
    WSGIScriptAlias /api /var/www/dev.fradgify.kozow.com/flask_app/flask_app.wsgi

    # Security Headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self';"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    ScriptLog ${APACHE_LOG_DIR}/cgi_log.log

    # Directory Directives
    <Directory "/var/www/dev.fradgify.kozow.com/media">
        Options +Indexes
        AllowOverride None
        Require all granted
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/music">
        Options +Indexes
        IndexOptions +Charset=UTF-8 +FancyIndexing
        IndexHeadInsert "<link rel='icon' href='/favicon.ico' type='image/x-icon'>"
        ReadmeName /spotify-footer.html
        AddType video/webm .webm .mov .m4v .mkv .mp4
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/movies">
        Options +Indexes
        IndexOptions +FancyIndexing
        ReadmeName /custom-footer.html
        AllowOverride None
        AddType video/webm .webm .mov .m4v .mkv
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/media/tv">
        Options +Indexes
        IndexOptions +FancyIndexing
        ReadmeName /disney-footer.html
        AllowOverride None
        AddType video/webm .webm .mov .m4v .mkv
    </Directory>

    <Directory "/usr/lib/cgi-bin/">
        AllowOverride None
        Options +ExecCGI
        Require all granted
        AddHandler cgi-script .py
    </Directory>

    <Directory "/var/www/dev.fradgify.kozow.com/static">
        Require all granted
    </Directory>
</VirtualHost>
